{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}
  <div class="container mt-3">
    {% if request.user != user %}
      <h1 class="main_color1 fw-bold mt-3 mb-3 text-center"><img src="{% static '/images/logo.png' %}" style="width:58px; height:58px;">
        {{ user.username }}님의 페이지</h1>
    {% else %}
      <h1 class="main_color1 fw-bold mt-3 mb-3 text-center"><img src="{% static '/images/logo.png' %}" style="width:58px; height:58px;">
        마이페이지</h1>
    {% endif %}
    <hr>

    <div class="row mt-5">
      <!-- 왼쪽 화면 -->
      <div class="col-5">
        <h4 class="main_color2 mb-3 fw-bold text-center">프로필</h4>
        <p class="text-center">
          {% if user.profile %}
            <img class='rounded-circle' style='height:180px;width:180px;' src="{{ user.profile.url }}" alt="{{ user.profile }}">
          {% else %}
            <img class='rounded-circle' style='height:180px;width:180px;' src="{% static '/images/profile/user.png'%}" alt="user">
          {% endif %}
        </p>
        <div class="text-center mt-3">
          <span>
            <span class="fw-bold main_color1">
              <a href="{% url 'accounts:follow_page' user.pk%}">팔로잉 수</a>
            </span>
            <span class="text-muted">{{ user.follow.count }}&nbsp&nbsp</span>
            <span class="fw-bold main_color1">
              <a href="{% url 'accounts:follow_page' user.pk%}">팔로워 수</a>
            </span>
            <span class="text-muted">{{ user.followers.count }}
            </span>
          </span>
        </div>
        <div class="text-center mt-1 mb-1">
          {% if request.user != user %}
            {% if request.user in user.followers.all %}
              <a href='{% url 'accounts:follow' user.pk%}' class='btn btn-sm login_btn fw-bold'>이 사용자를 UnFollow 하겠어요.</a>
            {% else %}
              <a href='{% url 'accounts:follow' user.pk %}' class='btn btn-sm signup_btn fw-bold'>이 사용자를 Follow 할래요!</a>
            {% endif %}
          {% endif %}
        </div>

        <!-- 쪽지 보내기 버튼 -->
        <div class="text-center mb-3">
          {% if request.user == user %}
            <a class='btn login_btn ms-auto' href="{%url 'accounts:note' %}" target="_blank" onclick="window.open(this.href, '', 'width=400, height=430 left=100px,top=100px'); return false;">
              <i class="bi bi-envelope"></i>
              쪽지함</a>
          {% endif %}
        </div>

        <div style="margin: 0 auto; width:50%;">
          {% if user.githuburl %}
            <p class="main_color1 fw-bold"><img style='height:30px;width:30px;' src="{% static '/images/github.png'%}">
              <a href="{{user.githuburl}}">
                {{ user.githuburl }}
              </a>
            </p>
          {% else %}
            <p><img style='height:30px;width:30px;' src="{% static '/images/github.png'%}">
              <a href="{% url 'accounts:update' %}" style="text-decoration: none;" class="main_color2">
                Github 주소를 등록해주세요.</a>
            </p>
          {% endif %}

          {% if user.email %}
            <p class="main_color1 fw-bold"><img style='height:30px;width:30px;' src="{% static '/images/email.png'%}">
              {{ user.email }}</p>
          {% else %}
            <p class="main_color2"><img style='height:30px;width:30px;' src="{% static '/images/email.png'%}">

              <a href="{% url 'accounts:update' %}" style="text-decoration: none;" class="main_color2">
                이메일 주소를 등록해주세요.</a>
            </p>
          {% endif %}

          <!-- user.post 태그 빈도수 높은 순 세개 호출 -->
          {% for tag in tagfreq %}
            {{ tag.tag }}
          {% endfor %}

        </div>
        {% if delta.years == 0 %}
          <p class="text-center fw-bold mt-3"><img style='height:45px;width:45px;' src="{% static '/images/0.png'%}">
            신입 개발자</p>
          <p>
            <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
            <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
            <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
            <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
            <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
          </p>
        {% else %}
          <div>
            <!-- 1~4년차 -->
            {% if delta.years > 0 and delta.years < 5 %}
              <p class="text-center fw-bold mt-3"><img style='height:45px;width:45px;' src="{% static '/images/1.png'%}">{{ delta.years }}년
                {{delta.months}}개월 경력, 초급 개발자</p>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <!-- 5~8년차 -->
            {% elif delta.years > 4 and delta.years < 9 %}
              <p class="text-center fw-bold mt-3"><img style='height:45px;width:45px;' src="{% static '/images/2.png'%}">
                {{ delta.years }}년 경력, 중급 개발자</p>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <!-- 9~12년차 -->
            {% elif delta.years > 8 and delta.years < 13 %}
              <p class="text-center fw-bold mt-3"><img style='height:45px;width:45px;' src="{% static '/images/3.png'%}">
                {{ delta.years }}년 경력, 고급 개발자</p>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <!-- 13~16년차 -->
            {% elif delta.years > 12 and delta.years < 17 %}
              <p class="text-center fw-bold mt-3"><img style='height:45px;width:45px;' src="{% static '/images/4.png'%}">
                {{ delta.years }}년 경력, 고급 개발자/관리자</p>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#EAEAEA;"></span>
              <!-- 17년 이상 -->
            {% else %}
              <p class="text-center fw-bold mt-3"><img style='height:45px;width:45px;' src="{% static '/images/5.png'%}">
                {{ delta.years }}년 경력, 고급 개발자/관리자/임원</p>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
              <span class="me-1" style="padding-left:20%; background-color:#7689DE;"></span>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <!-- 오른쪽 화면 -->

      <div class="col-6 ms-5">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#articles" data-toggle="tab">작성 글</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#comments" data-toggle="tab">댓글단 글</a>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="articles">
            <h5 class="main_color2 fw-bold">{{ user.username }}님이 작성한 글: 총
              {{ user.post_set.count }}개</h5>

            <div class="text-end">
              {% if posts.has_previous %}
                <span>
                  <a href="?page={{posts.previous_page_number}}"><img style='height:20px;width:20px;' src="{% static '/images/left.png'%}"></a>
                </span>
              {% endif %}
              <span class="text-muted">{{posts.number}}</span>
              <span class="text-muted">/</span>
              <span class="text-muted">{{posts.paginator.num_pages}}</span>
              {% if posts.has_next %}
                <span>
                  <a href="?page={{posts.next_page_number}}"><img style='height:20px;width:20px;' src="{% static '/images/right.png'%}"></a>
                </span>
              {% endif %}
            </div>

            {% for post in posts %}
              <span class="text-muted">
                <i class="bi bi-pencil-fill"></i>
                {{ forloop.counter }}번째 글:
              </span>
              <span>
                <a href="{% url 'posts:detail' post.pk%}" style="text-decoration: none;" class="text-muted">
                  {{ post.title }}
                </a>
              </span>
              <br>
            {% endfor %}
          </div>

          <div class="tab-pane fade" id="comments" style="height:50%;">
            <h5 class="main_color2 fw-bold">{{ user.username }}님이 작성한 댓글: 총
              {{ user.comment_set.count }}개</h5>

            <div class="text-end">
              {% if comments.has_previous %}
                <a href="?page={{comments.previous_page_number}}"><img style='height:20px;width:20px;' src="{% static '/images/left.png'%}"></a>
              </a>
            {% endif %}
            <span class="text-muted">{{comments.number}}</span>
            <span class="text-muted">/</span>
            <span class="text-muted">{{comments.paginator.num_pages}}</span>
            {% if comments.has_next %}
              <a href="?page={{comments.next_page_number}}"><img style='height:20px;width:20px;' src="{% static '/images/right.png'%}"></a>
            </a>
          {% endif %}
        </div>

        {% for comment in comments %}
          <span class="text-muted">
            <i class="bi bi-pencil-fill"></i>
            {{ forloop.counter }}번째 댓글:
          </span>
          <a href="{% url 'posts:detail' comment.article.pk %}" style="text-decoration: none;" class="text-muted">
            {{ comment.content }}
          </a>
          <br>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
</div>

<!-- 버튼 그룹 -->
<p class="text-center mt-4">
<a class="btn btn-outline-primary" href="{% url 'accounts:update' %}">수정</a>
<a class="btn btn-outline-success" href="{% url 'accounts:change_password' %}">비밀번호 변경</a>
<a class="btn login_btn" href="{% url 'articles:index' %}">홈으로 돌아가기</a>
<!-- Button trigger modal -->
<button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#exampleModal">
  회원탈퇴
</button>
<!-- follow/following -->

</p>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
  <div class="modal-header">
    <h1 class="modal-title fs-5" id="exampleModalLabel">정말로 탈퇴하시겠습니까?</h1>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>
  <div class="text-center">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">아니요</button>
    {% if request.user.login_method == 'email' %}
      <a class="btn btn-primary" href="{% url 'accounts:pw_check' request.user.pk%}">예</a>
    {% else %}
      <a class="btn btn-primary" href="{% url 'accounts:delete' request.user.pk%}">예</a>
    {% endif %}
  </div>
</div>
</div>
</div>
{% endblock content %}