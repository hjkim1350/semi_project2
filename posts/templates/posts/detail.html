{% extends 'base.html' %}
{% block content %}

<hr>
<div>
  <p> 제목:{{post.title}}</p>
  <p> 내용:{{post.content}}</p>
  <a href="{% url 'posts:update' %}"> 글 수정</a>
  <a href="{% url 'posts:delete' %}"> 글 삭제</a>
</div>

<hr>

<!-- 좋아요 -->

{% if user.is_authenticated %}
  {% if request.user in post.like.all %}
  <button type="button" style="opacity: 0.8;" data-post-id='{{ post.pk }}' id='fav-btn' class="btn btn-secondary bi bi-star-fill" ></button>
  {% else %}
  <button type="button"  id='fav-btn' data-post-id='{{ post.pk }}' style="opacity: 0.8;" class=" btn btn-secondary bi bi-star" >  </button>
  {% endif %}

  <span id='fav-count' class="text-center">{{ post.like.count }}</span>
  <span class="text-center">즐겨찾기</span>
{% endif %}




<!-- 댓글 -->

{% for comment in comments %}
<div class="d-flex px-3 border-top border-bottom" style="height: 5rem;">
  <div class="col-2 align-self-center">{{comment.user}}</div>
  <div class="col-8 align-self-center">{{comment.content}}</div>
  {% if request.user == comment.user %}

  <form action="{% url 'posts:comments_delete' post.pk comment.pk %}" method="POST" class="align-self-center">
    {% csrf_token %}
    <input class="" type="submit" value="삭제"> 
  </form>
  {% endif %}
  <hr class="my-3">
</div>
{% endfor %}
<div class="px-3 my-3">
  <form action="{% url 'posts:comments_create' post.pk %}" method="POST" class="border border-5 rounded p-3" style="background-color:whitesmoke;">
    {% csrf_token %}
    {% bootstrap_form comment_form %}
    <div class="text-end"><input class="btn btn-primary" type="submit" value="댓글 작성"></a>
    </div>
  </form>
</div>
{% endblock content %}

{% block script %}
<script>
  const favBtn = document.querySelector('#fav-btn')
  
  favBtn.addEventListener('click', function (event) {
    console.log(event.target.dataset)
    console.log(event.target.dataset.postId)
    
    axios({
      method:'get',
      url:`/${event.target.dataset.postId}/like/`
    })
    .then(response => {
      if (response.data.is_likes === true) { // 즐찾 했으면
        event.target.classList.add('bi-star-fill')
        event.target.classList.remove('bi-star')
      } else {
        event.target.classList.add('bi-star')
        event.target.classList.remove('bi-star-fill')
      }
      const favCount = document.querySelector('#fav-count')
      favCount.innerText = response.data.likes_count
    })
  })
</script>
{% endblock script %}
