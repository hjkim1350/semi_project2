{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}
  <div class='post_index container'>
    <h2 class='my-4' style='color:#7689DE'>
      <img src="{% static '/images/crown.png' %}" alt="" style="width:70px; height:70px;">현재 커뮤니티 인기글
    </h2>
    <form action="" method="POST">
      {% csrf_token %}
      <input class="btn btn-primary" name="tag" type="submit" value="전체">
      <input class="btn btn-primary" name="tag" type="submit" value="커리어">
      <input class="btn btn-primary" name="tag" type="submit" value="이직">
      <input class="btn btn-primary" name="tag" type="submit" value="회사생활">
      <input class="btn btn-primary" name="tag" type="submit" value="일상">
      <input class="btn btn-primary" name="tag" type="submit" value="개발">
      <input class="btn btn-primary" name="tag" type="submit" value="마케팅">
      <input class="btn btn-primary" name="tag" type="submit" value="HR"> 
    </form>

    <!-- 현재 인기 게시글-->
    <div class='row' style="width:100%;">
      <div class='col-4'>
        <div class="card " style="">
          <div class="card-body text-center" style="height:150px;">
            <h5 class="card-title fw-bold">글 제목이 들어가는 부분</h5>
            <div class='d-flex align-items-center justify-content-end my-3'>
              <a href="#"><img class='post_profile_img mx-1' src="{% static '/images/profile/user.png'%}" alt=""></a>
              <a class='text-decoration-none text-muted' href="#">작성자</a>
            </div>
          </div>
        </div>
      </div>
      <div class='col-4'>
        <div class="card " style="">
          <div class="card-body text-center" style="height:150px;">
            <h5 class="card-title fw-bold">글 제목이 들어가는 부분</h5>
            <div class='d-flex align-items-center justify-content-end my-3'>
              <a href="#"><img class='post_profile_img mx-1' src="{% static '/images/profile/user.png'%}" alt=""></a>
              <a class='text-decoration-none text-muted' href="#">작성자</a>
            </div>
          </div>
        </div>
      </div>
      <div class='col-4'>
        <div class="card" style="">
          <div class="card-body text-center" style="height:150px;">
            <h5 class="card-title fw-bold">글 제목이 들어가는 부분</h5>
            <div class='d-flex align-items-center justify-content-end my-3'>
              <a href="#"><img class='post_profile_img mx-1' src="{% static '/images/profile/user.png'%}" alt=""></a>
              <a class='text-decoration-none text-muted' href="#">작성자</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class='post_write mt-5'>
      <div class='post_write_box'>
        <a class="text-decoration-none text-dark" href="{% url 'posts:create' %}">면접 본 후기, 면접 본 회사에 대한 의견을 자유롭게 작성해보세요!</a>
        <a href="{% url 'posts:create' %}">
          <i class="bi bi-pencil-fill"></i>
        </a>
      </div>
    </div>

    <div class='post_list row justify-content-end my-3'>
      <div class="col-3">
        <div>검색어 순위</div>
      </div>
      <div class='col-9'>
        <div class='custom_select' style="float: right;">
          <select id="sort-select" onchange="location = this.value;">
            <option class="custom_option sort-date" value="?sort=date">최신순</option>
            <option class="custom_option sort-likes" value="?sort=likes">좋아요순</option>
            <option class="custom_option sort-comments" value="?sort=comments">댓글순</option>
          </select>
        </div>
        {% for post in posts_sort %}
          <div>
            <div class='px-4'>
              <a href="{%url 'accounts:detail' post.user.pk%}"><img class='post_profile_img mx-1' src="{% static '/images/profile/user.png'%}" alt=""></a>
              <a class='text-decoration-none text-muted' href="{%url 'accounts:detail' post.user.pk%}">{{post.user.username}}</a>
              <a class='text-decoration-none' href="{% url 'posts:detail' post.pk %}">
                <h3 class='text-dark mt-3'>{{post.title}}</h3>
                <p class='post_content text-muted'>{{post.content}}</p>
              </a>
              <div class='d-flex justify-content-between'>
                <p class='post_info'>{{post.created_at}}
                </p>
                <p class='post_info'>
                  <i class="bi bi-eye"></i>{{post.hits}}
                  <i class="bi bi-hand-thumbs-up"></i>{{post.like.count}}
                </p>
              </div>
            </div>
          </div>
          <hr>

        {% endfor %}
      </div>
    </div>
  </div>

  <script>
    // get url query string
    var getUrlParameter = function getUrlParameter(sParam) {
      var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

      for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
          return sParameterName[1] === undefined
            ? true
            : sParameterName[1];
        }
      }
    };
    // 정렬방식 셀렉트 박스 유지
    $(document).ready(function () {
      var sort = getUrlParameter('sort');
      if (sort == 'likes') {
        $('.sort-likes').prop('selected', 'selected')
      } else if (sort == 'comments') {
        $('.sort-comments').prop('selected', 'selected')
      } else {
        $('.sort-date').prop('selected', 'selected')
      }
    });
  </script>

{% endblock content %}
